# Radio Communication System - Audio & Messaging Behavior

This document explains how audio feedback and observer messages work when a character communicates over a radio in the game.

## Overview

When a character speaks into a radio (headset, handheld radio, etc.), the system provides audio and visual feedback to both the speaker's surroundings and the recipients. This creates an immersive experience where nearby observers know someone is using a radio, even if they can't hear the actual transmission.

---

## Audio Feedback ("Blip" Sounds)

There are **two distinct sounds** that play during radio communication:

### 1. Sender's Sound

**File:** `sound/effects/walkietalkie.ogg`

When a character initiates a radio transmission, a short "walkie-talkie" sound plays at the speaker's location. This only occurs if the radio is currently in the character's inventory (worn as a headset or held).

**Technical Details:**
- Called in the `talk_into()` proc on `/obj/item/device/radio`
- Volume: 20
- Condition: Radio must be located on the speaking mob (`loc == M`)

### 2. Receiver's Sound

**File:** `sound/effects/radio_chatter.ogg`

When radios receive an incoming broadcast, a "radio chatter" sound plays at each receiving radio's location. This lets nearby characters know that a radio transmission is coming through.

**Technical Details:**
- Called in the `Broadcast_Message()` proc in the telecomms broadcaster system
- Volume: 10 (quieter than sender's sound)
- The sender's own radio is excluded from playing this sound
- Has a 1-second cooldown per radio to prevent audio spam from rapid messages

---

## Observer Messages ("Talks Into Radio")

Characters who are near someone using a radio but aren't receiving the transmission themselves will see a contextual message indicating radio usage.

### What Observers See

> **"John McClane talks into the headset."**

This message appears to anyone within visible range of the speaker who can see them. The radio device name is dynamically inserted (e.g., "headset," "radio," "walkie-talkie").

### What Blind Characters Hear

> **"You hear someone talk into their headset."**

Characters who cannot see the speaker (due to blindness or obstructed vision) receive this alternate audible message instead.

### Technical Details

- Generated by calling `visible_message()` within the `say()` proc on `/mob/living`
- Default visual range: 5 tiles
- The speaking character is excluded from seeing this message about themselves
- The actual message visibility range can be modified by the language being spoken (see below)

---

## Language System Integration

The radio "talks into" message system integrates with the game's language system through two mechanisms:

### 1. NO_TALK_MSG Flag

Languages can have the `NO_TALK_MSG` flag set, which suppresses the "talks into the radio" message entirely. This is used for special cases like the "Noise" language (used for audible emotes) where showing a radio message wouldn't make sense.

### 2. get_talkinto_msg_range() Proc

Each language defines a `get_talkinto_msg_range()` proc that determines how far the "talks into radio" message travels:

- **Normal messages:** 1 tile range
- **Exclamatory messages (ending with `!`):** 2 tile range
- **Loud noises (Noise language):** 2-4 tile range

This means if you shout into a radio, more people nearby will notice you doing so.

---

## Complete Call Stack

Here's the sequence of events when a character speaks into a radio:

1. **Player input** → Character speaks with radio prefix (e.g., `;Hello`)

2. **`/mob/living/say()`** → Processes the message and detects radio mode

3. **`/mob/living/carbon/human/handle_message_mode()`** → Routes message to appropriate radio

4. **`/obj/item/device/radio/talk_into()`** → Initiates the radio transmission
   - Plays `walkietalkie.ogg` at speaker location
   - Creates signal for telecomms system

5. **`/mob/living/say()` (continued)** → After radio handling
   - Calls `visible_message()` to show "talks into the radio" to observers

6. **Telecomms Processing** → Signal travels through subspace network

7. **`Broadcast_Message()`** → Broadcasts to all receiving radios
   - Plays `radio_chatter.ogg` at each receiving radio
   - Delivers message to characters who can hear those radios

---

## Summary Table

| Event | Sound File | Volume | Location | Condition |
|-------|-----------|--------|----------|-----------|
| Speaking into radio | `walkietalkie.ogg` | 20 | Speaker | Radio in inventory |
| Radio receiving | `radio_chatter.ogg` | 10 | Each receiver | 1s cooldown, excludes sender |

| Observer Type | Message Shown |
|--------------|---------------|
| Can see speaker | "[Name] talks into the [radio]." |
| Cannot see (blind) | "You hear someone talk into their headset." |
| Speaker themselves | *(no message shown)* |
